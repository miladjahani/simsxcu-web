<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SimSXCu - شبیه‌ساز استخراج حلال مس</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      padding: 24px;
      margin-bottom: 20px;
    }
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .input-group {
      margin-bottom: 16px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #555;
    }
    input, select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e1e5e9;
      border-radius: 6px;
      font-size: 14px;
    }
    .parameter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
    .selector-container {
      display: flex;
      gap: 20px;
      justify-content: center;
    }
    #results-content {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 16px;
    }
    .result-item {
      background: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
      border-left: 4px solid #667eea;
    }
    .result-item strong {
      display: block;
      margin-bottom: 4px;
      color: #333;
    }
    #charts {
      min-height: 400px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header style="text-align: center; margin-bottom: 30px; color: white;">
      <h1>SimSXCu - نسخه تحت وب</h1>
      <p>شبیه‌ساز استخراج حلال مس با Lix984N</p>
      <div style="font-size: 14px; opacity: 0.9;">
        © 2016 Joseph Kafumbila - توسعه یافته برای دسترسی آنلاین
      </div>
    </header>

    <div class="card">
      <h2>انتخاب پیکربندی و گزینه</h2>
      <div class="selector-container">
        <div>
          <label for="config-selector">پیکربندی:</label>
          <select id="config-selector">
            <option value="A">پیکربندی A</option>
            <option value="B">پیکربندی B</option>
            <option value="C">پیکربندی C</option>
          </select>
        </div>
        <div>
          <label for="option-selector">گزینه:</label>
          <select id="option-selector">
            <option value="1">گزینه 1</option>
            <option value="2">گزینه 2</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>پارامترهای ورودی</h2>
      <div id="parameter-inputs" class="parameter-grid">
        <!-- Parameter inputs will be dynamically generated here -->
      </div>
    </div>

    <div class="card">
      <div style="display: flex; gap: 12px; justify-content: center;">
        <button id="run-simulation" class="btn">
          اجرای شبیه‌سازی
        </button>
        <button id="reset-simulation" class="btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
          بازنشانی
        </button>
      </div>
    </div>

    <div id="results-display" class="card" style="display: none;">
      <h2>نتایج شبیه‌سازی</h2>
      <div id="results-content"></div>
    </div>

    <div id="charts-container" class="card" style="display: none;">
      <h2>نمودارها</h2>
      <div id="charts"></div>
    </div>

    <footer style="text-align: center; margin-top: 40px; color: white; opacity: 0.8;">
      <p>SimSXCu Full Version 2.0 - توسعه یافته برای GitHub Pages</p>
      <p>jokafumbila@hotmail.com</p>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const DEFAULT_PARAMETERS = {
        PLS_flow: 400, PLS_Cu: 2.5, PLS_Ac: 1.6, SR: 92, Ratio_O_A_Ext: 1,
        Mef1e: 92, Mef2e: 95, SP_Cu: 30, SPAc: 190, AD_Cu: 50, Mef1s: 98, v_v_percent: 8.66
      };

      const PARAMETER_METADATA = [
        { id: 'PLS_flow', label: 'PLS Flow (m³/h)' }, { id: 'PLS_Cu', label: 'PLS Cu (g/L)' },
        { id: 'PLS_Ac', label: 'PLS Ac (g/L)' }, { id: 'SR', label: 'SR (%)' },
        { id: 'Ratio_O_A_Ext', label: 'O/A Ratio Ext' }, { id: 'Mef1e', label: 'Mef1e (%)' },
        { id: 'Mef2e', label: 'Mef2e (%)' }, { id: 'SP_Cu', label: 'SP Cu (g/L)' },
        { id: 'SPAc', label: 'SP Ac (g/L)' }, { id: 'AD_Cu', label: 'AD Cu (g/L)' },
        { id: 'Mef1s', label: 'Mef1s (%)' }, { id: 'v_v_percent', label: 'v/v Percent (%)' }
      ];

      let parameters = { ...DEFAULT_PARAMETERS };

      const parameterInputsContainer = document.getElementById('parameter-inputs');
      const runButton = document.getElementById('run-simulation');
      const resetButton = document.getElementById('reset-simulation');
      const resultsDisplay = document.getElementById('results-display');
      const resultsContent = document.getElementById('results-content');
      const chartsContainer = document.getElementById('charts-container');
      const chartsDiv = document.getElementById('charts');
      const optionSelector = document.getElementById('option-selector');

      class SimulationEngine {
        calculateAML(v_v_percent) { return 0.4108 * Math.pow(v_v_percent, 1.1); }
        calculateML(PLS_Ac, PLS_Cu, v_v_percent, AML) {
          if (v_v_percent === 0 || PLS_Cu === 0 || AML === 0) return 0;
          const term1 = Math.pow(PLS_Ac, 2) / PLS_Cu;
          const term2 = (-28.511 * Math.pow(v_v_percent, -1.746) * AML + 11.711 * Math.pow(v_v_percent, -0.646)) * Math.pow(3.303 * v_v_percent - 3.0842 * AML, 2) / AML;
          return term1 - term2;
        }
        calculateExtractionRecovery(PLS_Cu, raffinate_Cu) {
          if (PLS_Cu === 0) return 0;
          return ((PLS_Cu - raffinate_Cu) / PLS_Cu) * 100;
        }
        calculateStrippingRecovery(loaded_organic, stripped_organic) {
          if (loaded_organic === 0) return 0;
          return ((loaded_organic - stripped_organic) / loaded_organic) * 100;
        }
        calculateNetTransfer(loaded_organic, stripped_organic, v_v_percent) {
          if (v_v_percent === 0) return 0;
          return (loaded_organic - stripped_organic) / v_v_percent;
        }
        simulateOption1(params) {
          const AML = this.calculateAML(params.v_v_percent);
          const ML = this.calculateML(params.PLS_Ac, params.PLS_Cu, params.v_v_percent, AML);
          const loaded_organic = ML * params.SR / 100;
          const raffinate_Cu = params.PLS_Cu * (1 - params.Mef1e / 100) * (1 - params.Mef2e / 100);
          const raffinate_Ac = params.PLS_Ac + (params.PLS_Cu - raffinate_Cu) * 1.54;
          const extraction_recovery = this.calculateExtractionRecovery(params.PLS_Cu, raffinate_Cu);
          const stripped_organic = loaded_organic * 0.4;
          const stripping_recovery = this.calculateStrippingRecovery(loaded_organic, stripped_organic);
          const net_transfer = this.calculateNetTransfer(loaded_organic, stripped_organic, params.v_v_percent);
          return {
            'Optimum v/v%': params.v_v_percent, AML, ML, 'Loaded Organic': loaded_organic,
            'Raffinate Cu': raffinate_Cu, 'Raffinate Ac': raffinate_Ac,
            'Extraction Recovery': extraction_recovery, 'Stripping Recovery': stripping_recovery,
            'Net Transfer': net_transfer, 'Organic Flow': params.PLS_flow * params.Ratio_O_A_Ext
          };
        }
        simulateOption2(params) {
          const results = this.simulateOption1(params);
          results['Saturation Ratio'] = (results['Loaded Organic'] / results.ML) * 100;
          results['Mixer Efficiency E1'] = params.Mef1e;
          results['Mixer Efficiency E2'] = params.Mef2e;
          return results;
        }
        generateChartData(params) {
          const data = [];
          for (let i = 0; i <= 100; i += 10) {
            const AML = this.calculateAML(i);
            const ML = this.calculateML(params.PLS_Ac, params.PLS_Cu, i, AML);
            data.push({
              name: `${i}%`, AML: AML, ML: ML,
              loaded_organic: ML * params.SR / 100,
              extraction_efficiency: Math.min(95, 80 + i * 0.15)
            });
          }
          return data;
        }
      }

      const engine = new SimulationEngine();

      function generateParameterInputs() {
        parameterInputsContainer.innerHTML = '';
        PARAMETER_METADATA.forEach(param => {
          const group = document.createElement('div');
          group.className = 'input-group';
          const label = document.createElement('label');
          label.htmlFor = param.id;
          label.textContent = param.label;
          const input = document.createElement('input');
          input.type = 'number';
          input.id = param.id;
          input.value = parameters[param.id];
          input.step = "any";
          input.addEventListener('change', (e) => {
            parameters[param.id] = parseFloat(e.target.value);
          });
          group.appendChild(label);
          group.appendChild(input);
          parameterInputsContainer.appendChild(group);
        });
      }

      function displayResults(results) {
        resultsContent.innerHTML = '';
        for (const key in results) {
          const item = document.createElement('div');
          item.className = 'result-item';
          const value = typeof results[key] === 'number' ? results[key].toFixed(3) : results[key];
          item.innerHTML = `<strong>${key}:</strong> ${value}`;
          resultsContent.appendChild(item);
        }
        resultsDisplay.style.display = 'block';
      }
      
      function displayChart(data) {
          chartsDiv.innerHTML = 'Chart functionality requires a library, displaying raw data instead.';
          const pre = document.createElement('pre');
          pre.textContent = JSON.stringify(data, null, 2);
          chartsDiv.appendChild(pre);
          chartsContainer.style.display = 'block';
      }

      runButton.addEventListener('click', () => {
        const selectedOption = optionSelector.value;
        const simulationFn = selectedOption === '1' ? engine.simulateOption1.bind(engine) : engine.simulateOption2.bind(engine);
        const results = simulationFn(parameters);
        displayResults(results);
        const chartData = engine.generateChartData(parameters);
        displayChart(chartData);
      });

      resetButton.addEventListener('click', () => {
        parameters = { ...DEFAULT_PARAMETERS };
        generateParameterInputs();
        resultsDisplay.style.display = 'none';
        chartsContainer.style.display = 'none';
      });

      generateParameterInputs();
    });
  </script>
</body>
</html>